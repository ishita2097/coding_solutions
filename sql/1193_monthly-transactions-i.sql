select DATE_FORMAT(temp.trans_date, '%Y-%m') as month, temp.country as country, count(*) as trans_count, coalesce(count(app_id),0) as approved_count, sum(temp.amount) as trans_total_amount, coalesce(sum(approved_total_amount),0) as approved_total_amount from (select * from Transactions t left join (select id as app_id, amount as approved_total_amount from Transactions where state='approved') app on t.id = app_id) temp group by month, country;